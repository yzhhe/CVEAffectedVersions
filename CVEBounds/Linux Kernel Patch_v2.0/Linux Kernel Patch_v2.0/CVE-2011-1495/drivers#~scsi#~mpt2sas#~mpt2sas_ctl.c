diff --git a/drivers/scsi/mpt2sas/mpt2sas_ctl.c b/drivers/scsi/mpt2sas/mpt2sas_ctl.c
index e92b77a..3834c95 100644
--- a/drivers/scsi/mpt2sas/mpt2sas_ctl.c
+++ b/drivers/scsi/mpt2sas/mpt2sas_ctl.c
@@ -688,6 +688,13 @@
 _ctl_do_mpt_command(struct MPT2SAS_ADAPTER *ioc,
+	/* Check for overflow and wraparound */
+	if (karg.data_sge_offset * 4 > ioc->request_sz ||
+	    karg.data_sge_offset > (UINT_MAX / 4)) {
+		ret = -EINVAL;
+		goto out;
+	}
+
@@ -1963,7 +1970,7 @@
 _ctl_diag_read_buffer(void __user *arg, enum block_state state)
-	unsigned long timeleft;
+	unsigned long timeleft, request_size, copy_size;
@@ -1999,6 +2006,8 @@
 _ctl_diag_read_buffer(void __user *arg, enum block_state state)
+	request_size = ioc->diag_buffer_sz[buffer_type];
+
@@ -2006,13 +2015,23 @@
 _ctl_diag_read_buffer(void __user *arg, enum block_state state)
+	if (karg.starting_offset > request_size)
+		return -EINVAL;
+
+	/* Truncate data on requests that are too large */
+	if ((diag_data + karg.bytes_to_read < diag_data) ||
+	    (diag_data + karg.bytes_to_read > request_data + request_size))
+		copy_size = request_size - karg.starting_offset;
+	else
+		copy_size = karg.bytes_to_read;
+
-	    diag_data, karg.bytes_to_read)) {
+	    diag_data, copy_size)) {
